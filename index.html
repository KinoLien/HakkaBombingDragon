<!DOCTYPE html>
<html>
  <head>
  	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
  	<meta http-equiv="X-UA-Compatible" content="IE=10">
  	<!-- <meta http-equiv="X-UA-Compatible" content="IE=Edge"> -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  	<link rel="stylesheet" type="text/css" href="css/dragon.css" />
  	<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
  	<script type="text/javascript" src="js/parse-1.6.14.js"></script>
  	<script type="text/javascript" src="js/jQuery-FontSpy.js"></script>
  	<style type="text/css">
  		/*@media (min-width: 768px) {
  			.navbar-form .form-control{
  				width: 320px;
  			}
  			.table-path{
  				font-size: 16px;
    			margin: 6px 0;
  			}
  			.table-path > .glyphicon{
  				margin-right: 5px;
  			}
  		}
  		.loading{
  			margin: 7px 5px;
  			display: none;
  		}

		.container-scroll{
			overflow:auto;
		}
  		.glyphicon-refresh-animate {
		    -animation: spin .7s infinite linear;
		    -webkit-animation: spin2 .7s infinite linear;
		}

		@-webkit-keyframes spin2 {
		    from { -webkit-transform: rotate(0deg);}
		    to { -webkit-transform: rotate(360deg);}
		}

		@keyframes spin {
		    from { transform: scale(1) rotate(0deg);}
		    to { transform: scale(1) rotate(360deg);}
		}*/
  	</style>
  	<script>
		// document.getElementById('stage_1').addEventListener('mousemove', function(e){
		// var x = e.offsetX==undefined?e.layerX:e.offsetX;
		// var y = e.offsetY==undefined?e.layerY:e.offsetY;
		// console.log(x + " " + y);
		// });
		var protocol = document.location.protocol;
		var isAtRemote = protocol == 'http:' || protocol == 'https:';
		if(isAtRemote){
			Parse.initialize("cax2QbN9kyzd1lmtJhwn6gvodmUDVXjcnnbWmywS", "6xhOMYJpyFEEy8kqVkPwT1PYemY1VJpoG2nfCbW4");
		}else{
			// maybe use localstorage
			// Parse.initialize("cax2QbN9kyzd1lmtJhwn6gvodmUDVXjcnnbWmywS", "6xhOMYJpyFEEy8kqVkPwT1PYemY1VJpoG2nfCbW4");
			(function(scope){
				function localParse(){}
				function Leader(){}
				Leader.prototype = {
					save:function(attr, options){
						var all = localStorage.getItem('_hbd') || "[]";
						var data = JSON.parse(all);
						var serialNum = (data.length >= 1)? (data[data.length-1].serial + 1) : 1;
						var obj = {
							serial: serialNum,
							name: attr.name,
							score: attr.score,
							createdAt: new Date()
						};
						data.push(obj);
						localStorage.setItem('_hbd', JSON.stringify(data));
						options.success.call(this, obj);
					}
				};

				function Query(){}
				Query.prototype = {
					_orderField: "",
					descending:function(str){
						this._orderField = str;
						this._sortFn = function(a, b){return b[str]-a[str];};
					},
					limit:function(number){
						this._limit = number;
					},
					find:function(options){
						var field = this._orderField;
						var limit = this._limit;
						var all = localStorage.getItem('_hbd') || "[]";
						var data = JSON.parse(all);
						data.sort(this._sortFn);
						var res = data.slice(0, limit);
						for(var i = 0, len = res.length; i < len; i++){
							res[i].get = function(name){ return this[name]; };
							res[i].createdAt = new Date(res[i].createdAt);
						}
						options.success.call(this, res);
					}
				};
				localParse.Object = {
					extend:function(name){
						if(name == "Leader"){
							return Leader;
						}
					}
				};

				localParse.Query = Query;
				// localStorage
				scope.Parse = localParse;
			})(window)
		}
		
		window.TimeBar = (function(){
		  var _instances = {};

		  var timebarInstance = function(id){
		    this._jqel = $('#'+id);
		    this._int = null;
		    this._curs = 10.0;
		    this._sec = 10.0;
		    this._changeBegin = (1 / 3) * 100;
		    this._changeEnd = (1 / 15) * 100;
		    this._changeInt = this._changeBegin - this._changeEnd;
		  };

		  timebarInstance.prototype._stopInterval = function(){
		    if(this._int){
		      clearInterval(this._int);
		      this._int = null;
		    }
		  };

		  timebarInstance.prototype.clearBar = function(){
		    this._stopInterval();
		    this._curs = 0.0;
		    this._jqel.css("width", "0%").attr('aria-valuenow', 0);
		  };

		  timebarInstance.prototype.resetBar = function(){
		    this._stopInterval();
		    this._curs = this._sec;
		    // this._jqel.css("width", "100%").css("background-color", '#ffff00').attr('aria-valuenow', 100);
		    this._jqel.css("width", "100%").attr('aria-valuenow', 100);
		  };

		  timebarInstance.prototype.doStop = function(toClear, stopCallback){
		    this._stopInterval();
		    if(toClear){
		      this.clearBar();
		    }
		    if(typeof stopCallback == 'function'){
		    	stopCallback.call(this);
		    }
		  };

		  timebarInstance.prototype.doStart = function(stopCallback){
		    if(this._curs && this._int == null){
		      this._int = setInterval((function(scope){
		        return function(){
		          var s = parseFloat(scope._curs).toFixed(1);
		          if (s > 0){
		            scope._curs = s - 0.1;
		            var percent = 100 * scope._curs / scope._sec;
		            scope._jqel.css("width", percent+"%").attr('aria-valuenow', percent);
		            // if(percent >= scope._changeBegin){
		            //   scope._jqel.css("background-color", '#ffff00');
		            // }else if(percent > scope._changeEnd && percent < scope._changeBegin){
		            //   var percentInGreen = parseInt((percent - scope._changeEnd) / scope._changeInt * 255);
		            //   scope._jqel.css("background-color", '#ff'+ percentInGreen.toString(16) +'00');
		            // }else{
		            //   scope._jqel.css("background-color", '#ff0000');
		            // }
		          } else {
		            scope.doStop(undefined, stopCallback);
		          }
		        };
		      })(this), 100);
		    }
		  };

		  timebarInstance.prototype.setSecond = function(s){
		    if(this._int == null && !isNaN(s)){
		      this._sec = parseFloat(s).toFixed(1);
		      this._curs = this._sec;
		    }
		  };

		  timebarInstance.prototype.setSize = function(width, height){

		  };

		  var _getIns = function(id){
		    if(!_instances[id]){
		      _instances[id] = new timebarInstance(id);
		    }
		    return _instances[id];
		  };
		  return {
		    getInstanceById: _getIns
		  };
		})();

		window.stage1Process = {
			_processInterval: null,
			_showInterval: null,
			_fireworkProcessAll: [],
			_fireworkShowing: [],
			_fireworkPositions: [
				120, 20, 348, 0, 590, 0, 385, 210, 320, 369, 590, 260
			],
			_hasInitialized: false,
			_getValidIndex: function(){
				var min = 0,
					len = this._fireworkProcessAll.length,
					max = len - 1;
				if(len){
					return Math.floor(Math.random() * (max - min + 1) + min);
				}				
				return -1;
			},
			_processFn:function(startStamp){
				var imageUrl = "images/01-intro-firework.gif";
				var scope = this;
				return function(){
					var idx = scope._getValidIndex();
					var itemId = scope._fireworkProcessAll.splice(idx, 1)[0];
					scope._fireworkShowing.push(itemId);
					$(scope._showCacheTempMaps[itemId]).show();
					$(scope._showCacheTempMaps[itemId]).children(":first-child").attr('src', imageUrl);
					scope._showInterval[itemId] = setTimeout((function(id, outerScope){
						return function(){
							outerScope.stop(id);
							// console.log(id + " stop show");
						}
					})(itemId, scope), startStamp + 500);
					// console.log(itemId + " start show");
				};
			},
			init: function(){
				if(this._hasInitialized == false){
					var stage1El = $('#stage_1');
					// comment for the bugs
					// var fp = this._fireworkPositions;
					// for(var i = 0, j = 0, len = fp.length; i < len; i+=2, j++){
					// 	var str = '<div class="intro-firework" style="left:' + fp[i] + 'px;top:'
					// 		+ fp[i+1] + 'px;" f-n="' + (j+1) + '">' +
		  	// 				'<img width="100%" /></div>';
					// 	stage1El.append(str);
					// }
					this._el = stage1El;
					this._hasInitialized = true;
				}
			},
			start: function(){
				var scope = this;
				if(!scope._processInterval && !scope._showInterval){
					scope._showInterval = {};
					scope._showCacheTempMaps = {};
					var fws = document.querySelectorAll(".intro-firework");
					for(var i = 0, len = fws.length; i < len; i++){
						var item = fws[i];
						var id = item.getAttribute('f-n');
						scope._showCacheTempMaps[id] = item;
						scope._fireworkProcessAll.push(id);
					}

					scope._processInterval = setInterval(function(){
						setTimeout(scope._processFn(100), 100);
						setTimeout(scope._processFn(100), 100);
					}, 850);	
				}
			},
			stop: function(itemId){
				var showingIndex;
				if(!this._hasInitialized) return;
				var imageUrl = "images/01-intro-firework-stop.png";
				if(typeof itemId == 'undefined'){
					$(".intro-firework").hide();
					$(".intro-firework").children(":first-child").attr('src', imageUrl);
					clearInterval(this._processInterval);
					for(var i in this._showInterval){
						clearInterval(this._showInterval[i]);
					}
					this._processInterval = null;
					this._showInterval = null;
					this._showCacheTempMaps = null;
					this._fireworkProcessAll = [];
					this._fireworkShowing = [];
				}else if((showingIndex = this._fireworkShowing.indexOf(itemId)) != -1 && this._showInterval[itemId]){
					clearInterval(this._showInterval[itemId]);
					this._showInterval[itemId] = null;
					$(this._showCacheTempMaps[itemId]).hide();
					$(this._showCacheTempMaps[itemId]).children(":first-child").attr('src', imageUrl);
					// $("[" + this._bombAttrSelector + "=" + itemId + "]").hide();
					// back to all
					this._fireworkShowing.splice(showingIndex, 1);
					// console.log("stop and push: " + itemId);
					this._fireworkProcessAll.push(itemId);
					// console.log(this._fireworkProcessAll);
				}
			},
			reset:function(){
				this._processInterval = null;
				this._showInterval = null;
				this._showCacheTempMaps = null;
				this._fireworkProcessAll = [];
				this._fireworkShowing = [];
			}
		};

		window.stage2Process = {
			_hasInitialized:false,
			_textDom: null,
			_showInterval: null,
			_textStr: "小朋友，看完了「x龍迎新春」這本有趣的立體書，相信對客家的舞龍文化有點認識囉！這樣子吧，要不要來挑戰一下闖關遊戲呢？！通過以後，可能會有神龍降福喔！",
			init:function(){
				if(this._hasInitialized == false){
					var stageEl = $('#stage_2');
					this._textDom = stageEl.children(".message-text");

					$('.message-next').click(function(){
						gamer.toNext();
					});
					this._el = stageEl;
					this._hasInitialized = true;
				}
			},
			start:function(){
				var scope = this;
				scope._showInterval = {};
				$(".message-dialog").fadeIn({
					complete:function(){
						var text = scope._textStr;
						for(var i = 0, len = text.length; i < len; i++){
							scope._showInterval[i.toString()] = setTimeout((function(str, dom){
								return function(){
									if(str == 'x'){
										dom.append('<span class="b-word">　&nbsp;</span>');
									}else if(str == "呢"){
										dom.append('<span class="font-zhuin-poin1">' + str + '</span>');
									}else{
										dom.append(document.createTextNode(str));
									}
								};
							})(text[i], scope._textDom), (i+1) * 200);

							if(i + 1 == len){
								scope._showInterval["ended"] = setTimeout(function(){
									$(".message-next").addClass('to-zoom-small');
									$(".message-oldman img").attr('src', 'images/02-message-oldman-2.gif');
								}, (i + 1) * 200);
							}
						}
					}
				});
			},
			stop:function(){
				for(var i in this._showInterval){
					clearInterval(this._showInterval[i]);
				}
				this._showInterval = null;
				this.reset();
			},
			reset:function(){
				this._textDom.empty();
				$(".message-next").removeClass('to-zoom-small');
				$(".message-oldman img").attr('src', 'images/02-message-oldman.gif');
			}
		};

		window.stage3Process = {
			_hasInitialized:false,
			_textDom: null,
			_showInterval: null,
			_textStr: "1. x龍儀式共分為三個關卡，鞭炮出現的速度會越來越快。\n2. 每個關卡請在20秒內完成，點中1個鞭炮可得2分，點中10個鞭炮即可過關。\n3. 過關後會跑出小常識加分題，請在20秒內回答問題，答對1題可得5分。",
			init:function(){
				if(this._hasInitialized == false){
					var stageEl = $('#stage_3');
					this._textDom = stageEl.children(".rules-text");
					this._el = stageEl;
					this._hasInitialized = true;
				}
			},
			start:function(){
				var scope = this;
				scope._showInterval = {};
				var text = scope._textStr;
				for(var i = 0, len = text.length; i < len; i++){
					scope._showInterval[i.toString()] = setTimeout((function(str, dom){
						return function(){
							if(str == '\n'){
								dom.append('<div style="height:10px;"></div>');
							}else if(str == 'x'){
								dom.append('<span class="b-word-white">　&nbsp;</span>');
							}else{
								dom.append(document.createTextNode(str));
							}
						};
					})(text[i], scope._textDom), (i+1) * 200);
					if(i + 1 == len){
						scope._showInterval['ended'] = setTimeout(function(){
							$(".button-rules-enter").addClass('to-zoom');
						}, (i+1) * 200 );
					}
				}
			},
			stop: function(){
				for(var i in this._showInterval){
					clearInterval(this._showInterval[i]);
				}
				this._showInterval = null;
				this.reset();
			},
			reset: function(){
				this._textDom.empty();
				$(".button-rules-enter").removeClass('to-zoom');
			}
		};

		window.stage4Process = {
			_bombPositions: [
				280, 365, 160, 380, 356, 315, 420, 375, 590, 315, 500, 235, 400, 255,
				240, 350, 235, 385, 105, 385, 190, 382, 120, 365, 324, 300, 261, 285,
				288, 260, 570, 288, 535, 310, 480, 290, 485, 315, 480, 246, 525, 278,
				455, 239, 440, 258, 468, 277, 312, 276, 315, 250, 385, 310, 333, 360,
				323, 380, 358, 375, 386, 389, 386, 359, 409, 329, 414, 288, 383, 282,
				359, 279, 359, 244, 292, 311, 572, 348, 445, 305
			],
			_fruitNumbers: [1,2,3,4,5,6],
			_bombSrc: "images/04-bomb9.png",
			_exploSrc: "images/04-explosion.gif",
			_personInterval: null,
			_oldmanInterval: null,
			_fruitInterval: null,
			_processInterval: null,
			_showInterval: null,
			_showSeconds: 3,
			_limitSeconds: 20,
			_timebar: null,
			_bombProcessAll:[],
			_bombShowing:[],
			_bombSelector: "div[b-n]",
			_bombAttrSelector: "b-n",
			_bombNumbers: 0,
			_hasPersonMove: false,
			_hasOldmanMove: false,
			_hasInitialized: false,
			_forceToJump: false,
			_movePerson: false,
			_moveOldman: false,
			_getValidIndex: function() {
				var min = 0,
					len = this._bombProcessAll.length,
					max = len - 1;
				if(len){
					return Math.floor(Math.random() * (max - min + 1) + min);
				}				
				return -1;
			},
			_getValidFruit: function(){
				var min = 0,
					len = this._fruitNumbers.length,
					max = len - 1;
				if(len){
					return this._fruitNumbers[Math.floor(Math.random() * (max - min + 1) + min)];
				}				
				return -1;
			},
			_startPersonMove:function(){
				var moveObj = $('#person_move');
				moveObj.addClass('to-move');
				this._personInterval = setInterval(function(){
					if(moveObj.hasClass('pos')){
						moveObj.removeClass('pos');
					}else{
						moveObj.addClass('pos');
					}
				},2500);
				moveObj.show();
			},
			_stopPersonMove:function(){
				var moveObj = $('#person_move');
				clearInterval(this._personInterval);
				this._personInterval = null;
				moveObj.removeClass('pos to-move');
				moveObj.hide();
			},
			_startOldmanMove:function(){
				var scope = this;
				var moveObj = $('#oldman_move');
				moveObj.addClass('to-move-old');
				scope._oldmanInterval = setInterval(function(){
					if(moveObj.hasClass('pos-old')){
						moveObj.removeClass('pos-old');
					}else{
						moveObj.addClass('pos-old');
					}
				},3500);
				scope._fruitInterval = setInterval(function(){
					var num = scope._getValidFruit();
					var left = parseFloat(moveObj.css('left')) + 30;
					var str = '<div class="fruit" style="left:' + left + 'px;' +
						'"><img src="images/04-fruit-' + num + 
						'.png" width="100%" /></div>';
					var stage4El = $('#stage_4');
					stage4El.append(str);
					var wrap = stage4El.children(".fruit:last-child");
					var imgEl = wrap.children("img:first-child");
					imgEl.click(function(){
						wrap.stop();
						wrap.remove();
						gamer.addScore('fruit');
					});
					wrap.animate({top:470},{
						duration:2000,
						easing: "linear",
						complete:function(){
							wrap.remove();
						}
					});
				}, 800);
				moveObj.show();
			},
			_stopOldmanMove:function(){
				var moveObj = $('#oldman_move');
				clearInterval(this._oldmanInterval);
				clearInterval(this._fruitInterval);
				this._oldmanInterval = null;
				this._fruitInterval = null;
				moveObj.removeClass('pos-old to-move-old');
				moveObj.hide();
				$('#stage_4').children(".fruit").stop().remove();
			},
			setProperty: function(name, value){
				this[name] = value;
				if(name == "_bombNumbers"){
					$(".b-counter").text(value);
				}
			},
			getProperty: function(name){
				return this[name];
			},
			changeLevelName: function(name){
				$(".question-level-name, .level-name").text(name);
			},
			init:function(){
				var scope = this;
				if(scope._hasInitialized == false){
					var stage4El = $('#stage_4');
					var bp = scope._bombPositions;
					for(var i = 0, j = 0, len = bp.length; i < len; i+=2, j++){
						var str = '<div class="bomb" style="left:' + bp[i] + 'px;top:'
							+ bp[i+1] + 'px;" b-n="' + (j+1) + '">' +
		  					'<img class="b-body-part" width="100%" /><img class="b-explo-part" width="100%" /></div>';
						stage4El.append(str);
					}

					$(".b-body-part").attr('src', scope._bombSrc);

					$(".b-body-part").click(function(){
						var bombBody = $(this);
						var hasClicked = bombBody.attr('is-clicked');
						// console.log(hasClicked);
						if(hasClicked == 'true') return false;
						gamer.addScore("bomb", 1);
						bombBody.attr('is-clicked', true);
						bombBody.attr('src', scope._exploSrc).width('80%').css('margin','12px 8px');

						var audioStr = '<audio autoplay><source src="sounds/sound-bomb.mp3" type="audio/mpeg"/></audio>';
						stage4El.append(audioStr);
						var audioEl = stage4El.children('audio:last-child');
						audioEl.on('ended', function(){ $(this).remove(); });

						// for stop jumping at show explosion
						var itemId = bombBody.parent().attr("b-n");
						if(itemId){
							clearInterval(scope._showInterval[itemId]);
							setTimeout((function(bb, id){
								return function(){ 
									scope.stop(id);
									bb.attr('src', scope._bombSrc).width('100%').css('margin','');
									bb.attr('is-clicked', false);
									// bb.show();
									// eb.hide();
								};
							})(bombBody, itemId), 350);
						}
					});

					$('.b-next-button, .b-again-button').click(function(){
						$(".b-transform").removeClass("next again");
						scope._relateAudio.pause();
						scope._relateAudio.load();
					});

					$(".b-next-button").click(function(){
						gamer.toNext();
					});

					$(".b-again-button").click(function(){
						gamer.restoreScore();
						gamer.forceToStage(4);
					});
					
					var tb = this._timebar = TimeBar.getInstanceById('bomb_timebar');
					tb.setSecond(this._limitSeconds);	
					scope._el = stage4El;
					scope._hasInitialized = true;
				}
			},
			start:function(){
				if(!this._processInterval && !this._showInterval){
					this._showInterval = {};
					this.__showCacheTempMaps = {};
					this.setProperty('_bombNumbers', 0);
					$(this._bombSelector).each((function(scope){
						return function(i,item){
							var id = item.getAttribute(scope._bombAttrSelector);
							scope.__showCacheTempMaps[id] = item;
							scope._bombProcessAll.push(id);
						};
					})(this));
					this._processInterval = setInterval((function(scope, s){
						return function(){	
							var idx = scope._getValidIndex();
							if(idx != -1){
								// console.log("validIndex: " + idx);
								var itemId = scope._bombProcessAll.splice(idx, 1)[0];
								// console.log("get Item id: " + itemId);
								scope._bombShowing.push(itemId);
								$(scope.__showCacheTempMaps[itemId]).show();
								// $("[" + scope._bombAttrSelector + "=" + itemId + "]").show();
								scope._showInterval[itemId] = setTimeout((function(id, outerScope){
									return function(){ 
										if(id) outerScope.stop(id);
									}
								})(itemId, scope), s * 1000);
							}
						};
					})(this, this._showSeconds), this._showSeconds * 1000 / 5);	
					this._timebar.resetBar();
					this._timebar.doStart((function(scope){
						return function(){ 
							scope.stop();
							var toAddClass = "", relateAudio;
							if(scope.getProperty('_bombNumbers') >= 10){
								toAddClass = "next";
								scope._relateAudio = document.getElementById('passAudio');
							}else{
								toAddClass = "again";
								scope._relateAudio = document.getElementById('notpassAudio');
							} 
							scope._relateAudio.play();
							document.getElementById('playAudio').pause();
							setTimeout(function(){
								if(toAddClass == "next" && scope._forceToJump){
									$(".b-next-button").trigger('click');
								}else{
									$(".b-transform").addClass(toAddClass);
								}
							}, 500);
						};
					})(this));
					gamer.startCacheScore();
					gamer.updateScore();
					if(this._hasPersonMove){
						this._startPersonMove();
					}
					if(this._hasOldmanMove){
						this._startOldmanMove();
					}
				}
			},
			stop:function(itemId){
				var showingIndex;
				if(typeof itemId == 'undefined'){
					$(this._bombSelector).hide();
					clearInterval(this._processInterval);
					for(var i in this._showInterval){
						clearInterval(this._showInterval[i]);
					}
					if(this._hasPersonMove){
						this._stopPersonMove();
					}
					if(this._hasOldmanMove){
						this._stopOldmanMove();
					}
					// console.log("stop all");
					this._processInterval = null;
					this._showInterval = null;
					this.__showCacheTempMaps = null;
					this._bombProcessAll = [];
					this._bombShowing = [];	
				}else if((showingIndex = this._bombShowing.indexOf(itemId)) != -1 && this._showInterval[itemId]){
					clearInterval(this._showInterval[itemId]);
					this._showInterval[itemId] = null;
					$(this.__showCacheTempMaps[itemId]).hide();
					// $("[" + this._bombAttrSelector + "=" + itemId + "]").hide();
					// back to all
					this._bombShowing.splice(showingIndex, 1);
					// console.log("stop and push: " + itemId);
					this._bombProcessAll.push(itemId);
				}
			},
			reset: function(){
				this._personInterval = null;
				this._oldmanInterval = null;
				this._processInterval = null;
				this._showInterval = null;
				this._fruitInterval = null;
				this._showSeconds = 3;
				this._limitSeconds = 20;
				this._bombProcessAll = [];
				this._bombShowing = [];
				this._bombNumbers = 0;
				this._hasPersonMove = false;
				this._hasOldmanMove = false;
				this._forceToJump = false;
				this._movePerson = false;
				this._moveOldman = false;
			}
		};

		window.stage5Process = {
			_hasInitialized: false,
			_questions: [
				{
					title: 'x龍是客庄十二大節慶活動，也是臺灣客家族群元宵節的慶典活動。',
					res: true, index: 0
				},
				{
					title: 'x龍是客庄十二大節慶活動，也是臺灣原住民族元宵節的慶典活動。',
					res: false, index: 1
				},
				{
					title: 'x龍是客庄十二大節慶活動，也是臺灣客家族群中秋節的慶典活動。',
					res: false, index: 2
				},
				{
					title: 'x龍儀式是高雄地區最熱鬧有趣的元宵慶典活動。',
					res: false, index: 3
				},
				{
					title: 'x龍是苗栗地區最熱鬧有趣的元宵慶典活動。',
					res: true, index: 4
				},
				{
					title: '「x」是客家話「炸」的意思，「x龍」就是用鞭炮炸龍。',
					res: true, index: 5
				},
				{
					title: '「跈龍」就是用鞭炮炸龍的意思。',
					res: false, index: 6
				},
				{
					title: '好客龍的尾巴捲捲的，跟別的龍有些不一樣，尾巴向左捲的是母龍，向右捲的是公龍。',
					res: false, index: 7
				},
				{
					title: '好客龍的尾巴捲捲的，跟別的龍有些不一樣，尾巴向右捲的是母龍，向左捲的是公龍。',
					res: true, index: 8
				},
				{
					title: '糊龍通常在過年前完成，使用苗栗盛產的桂竹，製作完龍頭、龍尾及龍圈，糊上龍衣就完成了。',
					res: true, index: 9
				},
				{
					title: '糊龍通常在過年前完成，使用苗栗盛產的藺草，製作完龍頭、龍尾及龍圈，糊上龍衣就完成了。',
					res: false, index: 10
				},
				{
					title: '糊好的龍在出龍參拜前，要到媽祖廟前開光點睛、插金花、綁紅巾，祈求神明賜予神靈瑞氣。',
					res: false, index: 11
				},
				{
					title: '糊好的龍在出龍參拜前，要到伯公廟前開光點睛、插金花、綁紅巾，祈求神明賜予神靈瑞氣。',
					res: true, index: 12
				},
				{
					title: '依照傳統習俗，龍隊會在正月十五開始遶境，連續三天向家家戶戶拜年，為大家帶來祥瑞之氣。',
					res: true, index: 13
				},
				{
					title: '「跈龍」就是跟著龍隊走。',
					res: true, index: 14
				},
				{
					title: '「跈龍」是在伯公廟前感謝神龍庇佑家園，並送祂返回天上的儀式。',
					res: false, index: 15
				},
				{
					title: '在客家習俗中，跈龍除了可以吸收帶來平安吉祥的龍氣，也有跟著神龍前往光明大道的涵意。',
					res: true, index: 16
				},
				{
					title: 'x龍就是用鞭炮炸龍，是活動最熱鬧的時候，除了祈福消災，也希望新的一年運勢能夠越炸越旺！',
					res: true, index: 17
				},
				{
					title: '結束為期五天的迎龍之後，龍隊會回到點睛的伯公廟前舉行化龍儀式。',
					res: false, index: 18
				},
				{
					title: '結束為期三天的迎龍之後，龍隊會回到點睛的三山國王廟前舉行化龍儀式。',
					res: false, index: 19
				}
			],
			// _questionsTemp: null,
			_timebar: null,
			_limitSeconds: 20,
			_showInterval: null,
			_getValidQuestion:function(){
				var min = 0,
					len = this._questions.length,
					max = len - 1;
				if(len){
					var idx = Math.floor(Math.random() * (max - min + 1) + min);
					return this._questions[idx];
				}				
				return null;
			},
			_clearText:function(){
				for(var i in this._showInterval){
					clearInterval(this._showInterval[i]);
				}
				this._showInterval = null;
				this._textDom.empty();
			},
			init: function(){
				if(this._hasInitialized == false){
					var stageEl = $('#stage_5');
					this._textDom = stageEl.children(".question-text");

					var tb = this._timebar = TimeBar.getInstanceById('question_timebar');
					tb.setSecond(this._limitSeconds);
					this._el = stageEl;
					this._hasInitialized = true;
				}
			},
			start: function(){
				var scope = this;
				var stageEl = $('#stage_5');
				if(!scope._showInterval){
					scope._showInterval = {};
					// this.__showCacheTempMaps = {};
					// this.setProperty('_bombNumbers', 0);
					// $(this._bombSelector).each((function(scope){
					// 	return function(i,item){
					// 		var id = item.getAttribute(scope._bombAttrSelector);
					// 		scope.__showCacheTempMaps[id] = item;
					// 		scope._bombProcessAll.push(id);
					// 	};
					// })(this));
					// this._processInterval = setInterval((function(scope, s){
					// 	return function(){	
					// 		var idx = scope._getValidIndex();
					// 		if(idx != -1){
					// 			// console.log("validIndex: " + idx);
					// 			var itemId = scope._bombProcessAll.splice(idx, 1)[0];
					// 			// console.log("get Item id: " + itemId);
					// 			scope._bombShowing.push(itemId);
					// 			$(scope.__showCacheTempMaps[itemId]).show();
					// 			// $("[" + scope._bombAttrSelector + "=" + itemId + "]").show();
					// 			scope._showInterval[itemId] = setTimeout((function(id, outerScope){
					// 				return function(){ 
					// 					if(id) outerScope.stop(id);
					// 				}
					// 			})(itemId, scope), s * 1000);
					// 		}
					// 	};
					// })(this, this._showSeconds), this._showSeconds * 1000 / 5);	
					// var qs = scope._questions;
					// for(var i = 0, len = text.length; i < len; i++){
					// 	scope._showInterval[i.toString()] = setTimeout((function(str, dom){
					// 		return function(){
					// 			var textNode = document.createTextNode(str);
					// 			dom.append(textNode);
					// 		};
					// 	})(text[i], scope._textDom), (i+1) * 200);
					// }

					function showQuestionFn(){
						var qs = scope._currentQuestion = scope._getValidQuestion();
						var text = qs.title;
						scope._showInterval = {};
						for(var i = 0, len = text.length; i < len; i++){
							scope._showInterval[i.toString()] = setTimeout((function(idx, str, dom){
								return function(){
									if(str == 'x'){
										dom.append('<span class="b-word-white">　&nbsp;</span>');
									}else if((idx == 7 || idx == 8) && (str == "好" || str == "巴" || str == "一")){
										dom.append('<span class="font-zhuin-poin1">' + str + '</span>');
									}else if(idx == 13 && str == "正"){
										dom.append('<span class="font-zhuin-poin1">' + str + '</span>');
									}else{
										dom.append(document.createTextNode(str));
									}
								};
							})(qs.index, text[i], scope._textDom), (i+1) * 100);
						}
					}

					$(".question-button").click(function(){
						var htmlStr;
						scope._clearText();
						if(scope._currentQuestion.res.toString() == this.getAttribute('a-n')){
							// right
							gamer.addScore('question');
							htmlStr = '<audio autoplay><source src="sounds/sound-correct.mp3" type="audio/mpeg"/></audio>';
						}else{
							// wrong
							htmlStr = '<audio autoplay><source src="sounds/sound-wrong.mp3" type="audio/mpeg"/></audio>';
						}
						stageEl.append(htmlStr);
						var audioEl = stageEl.children('audio:last-child');
						audioEl.on('ended', function(){ $(this).remove(); });
						showQuestionFn();
					});
					

					scope._timebar.resetBar();
					scope._timebar.doStart((function(){
						return function(){ 
							// scope.stop();
							gamer.toNext();
							// var toAddClass = "";
							// if(scope.getProperty('_bombNumbers') >= 10) toAddClass = "next";
							// else toAddClass = "again"; 
							// setTimeout(function(){ $(".b-transform").addClass(toAddClass); }, 500);
						};
					})());
					gamer.updateScore();
					showQuestionFn();
				}
			},
			stop: function(){
				this._clearText();
				$(".question-button").off("click");
			},
			reset: function(){
				this._limitSeconds = 20;
				this._showInterval = null;
			}
		};

		window.stage6Process = {
			_comments: [
				{
					range: '60~79',
					comment: '你好棒，果然難不倒你'
				}, {
					range: '80~99',
					comment: 'x龍達人，非你莫屬'
				}, {
					range: '100~',
					comment: '你是天才，神龍賜福於你'
				}
			],
			_textDom: null,
			_hasInitialized: false,
			_showInterval: null,
			_getComments: function(){
				var score = gamer._totalScore,
					comments = this._comments,
					i = 0, len = comments.length;
				for( ; i < len; i++){
					var o = comments[i];
					var ranges = o.range.split('~');
					var left = parseInt(ranges[0]);
					var right = parseInt(ranges[1]);
					left = isNaN(left)? 0 : left;
					right = isNaN(right)? (score + 1) : right;
					if(score >= left && score < right){
						return o.comment;
					}
				}
				return "";
			},
			init:function(){
				if(this._hasInitialized == false){
					var stageEl = $('#stage_6');
					this._textDom = stageEl.children(".results-comment");
					this._scoreDom = stageEl.children(".results-score");
					$('.results-next').click(function(){
						gamer.toNext();
					});
					this._el = stageEl;
					this._hasInitialized = true;
				}
			},
			start:function(){
				// should get scores for this stage
				var scope = this;
				var text = scope._getComments();
				scope._showInterval = {};
				for(var i = 0, len = text.length; i < len; i++){
					scope._showInterval[i.toString()] = setTimeout((function(str, dom){
						return function(){
							if(str == 'x'){
								dom.append('<span class="b-word">　&nbsp;</span>');
							}else{
								dom.append(document.createTextNode(str));
							}
						};
					})(text[i], scope._textDom), (i+1) * 200);

					if(i + 1 == len){
						scope._showInterval["_score"] = setTimeout((function(str, dom){
							return function(){
								var textNode = document.createTextNode(str);
								dom.append(textNode);
							};
						})(gamer._totalScore, scope._scoreDom), (i + 2) * 200);
					}

					if(i + 1 == len){
						scope._showInterval["ended"] = setTimeout(function(){
							$(".results-next").addClass('to-zoom-small');
						}, (i + 2) * 200);
					}
				}
			},
			stop:function(){
				for(var i in this._showInterval){
					clearInterval(this._showInterval[i]);
				}
				this._showInterval = null;
				this._textDom.empty();
				this._scoreDom.empty();
				$(".results-next").removeClass('to-zoom-small');
			},
			reset:function(){
				this._showInterval = null;
			}
		};

		window.stage7Process = {
			_hasInitialized: false,
			_isInLeader: false,
			// _scoreHasRecord: false,
			_checkInput:function(toShow){
				// this._shouldBeRecord = true;
				// if(gamer._scoreHasRecord == false && gamer._totalScore > this._minScore){
				// 	scope._minScore
				// }
				this._isInLeader = toShow;
				if(toShow){
					$(".leader-input-wrap").show();
				}else{
					$(".leader-input-wrap").hide();
				}
			},
			_reload:function(){
				var scope = this;
				gamer.loadScores(function(results){
					for(var i = 0, len = results.length; i < len; i++){
						var item = results[i];
						var htmlStr = '<div class="leader-tuple"><table><tr>' + 
						    '<td class="leader-order">' + item.order + '.</td>' +
						    '<td class="leader-name"><u>' + item.name + '</u></td>' +
						    '<td class="leader-score">' + item.score + '</td>' +
						    '<td class="leader-score-text">分</td>' + 
							'<td class="leader-time">' + item.date + '</td>' +
		  					'</tr></table></div>';
		  				scope._leaderWrap.append(htmlStr);
					}
					scope._checkInput(gamer.canBeRecord());
				});
			},
			init:function(){
				var scope = this;
				if(scope._hasInitialized == false){

					$('.leader-confirm').click(function(){
						// gamer.toNext();
						if(scope._isInLeader){
							// to update score and refresh
							// alert($('#leader-input').val());
							var name = $('#leader-input').val();
							name = $.trim(name);
							if(name){
								gamer.addScoreToRemote(name, function(){
									$('#leader-input').val("");
									gamer.forceToStage(7);
								});
							}
						}else{
							gamer.replay();
						}
					});

					scope._leaderWrap = $('.leader-wrap');
					scope._el = $("#stage_7");
					scope._hasInitialized = true;
				}
			},
			start:function(){
				this._reload();
			},
			stop:function(){
				this._leaderWrap.empty();
				this._isInLeader = false;
			},
			reset:function() {
				this._isInLeader = this;
			}
		};

		window.gamer = {
			_registerStages: [1, 2, 3, 4, 5, 6, 7],
			_stageElSelector: ".stage",
			_stageNamePrefix: "stage_",
			_stageNumberRex: new RegExp("stage_(.*)"),
			_stageSelectProperty: "id",
			_bombNumbers: 0,
			_totalScore: 0,
			_bombStageTimes: 1,
			_scoreHasRecord:false,
			currentStage: 1,
			// _getPoinWord: function(text, forceUse){
			// 	var poin1 = ["呢"];
			// 	var poin2 = [];
			// 	if(forceUse){
			// 		return '<span class="font-zhuin-poin' + forceUse + '">' + text + '</span>';
			// 	}
			// 	if(~poin1.indexOf(text)){
			// 		return '<span class="font-zhuin-poin1">' + text + '</span>';
			// 	}else if(~poin2.indexOf(text)){
			// 		return '<span class="font-zhuin-poin2">' + text + '</span>';
			// 	}
			// 	return '';
			// },
			_getProcess: function(stage){
				return window["stage" + stage + "Process"];
			},
			_getProcessEl: function(stage){
				return $('#stage_' + stage);
			},
			// [ 'stage_1', '1', index: 0, input: 'stage_1' ]
			_findStage:function(el){
				var parentEl = $(el).parents(this._stageElSelector);
				if(parentEl){
					var prop = $(parentEl).attr(this._stageSelectProperty);
					var number = this._stageNumberRex.test(prop) ? prop.match(this._stageNumberRex)[1] : null;
					if(number) this.currentStage = number;
				}
			},
			initProcess:function(){
				var r = this._registerStages,
					i = 0,
					len = r.length;
				for(; i < len; i++){
					this._getProcess(r[i]).init();
				}
				$(".b-counter").text(this._bombNumbers);
				$(".b-score-counter").text(this._totalScore);
			},
			resetProcess:function(){
				var r = this._registerStages,
					i = 0,
					len = r.length;
				for(; i < len; i++){
					this._getProcess(r[i]).reset();
				}
			},
			forceToStage: function(name){
				// var currentProcess = this._getProcess(this.currentStage);
				// if(currentProcess) currentProcess.stop();
				this._getProcess(this.currentStage).stop();
				this.currentStage = name;
				// currentProcess.init();
				$('[' + this._stageSelectProperty + '^=' + this._stageNamePrefix + ']').hide();
				$('[' + this._stageSelectProperty + '^=' + 
					this._stageNamePrefix + name + ']')[name == 1?'fadeIn':'show'](function(){
						$('.loading-wrap').hide();
					});
				if(name == 1){
					document.getElementById('introAudio').play();
				}

				this._getProcess(this.currentStage).start();
				// currentProcess.start();
				// $('[' + this._stageSelectProperty + '^=' + this._stageNamePrefix + name + ']').fadeIn({
				// 	complete:function(){
				// 		currentProcess.start();
				// 	}
				// });
			},
			toNext: function(){
				if(typeof this.currentStage == 'undefined' || this.currentStage == null){
					// ???
				}
				var nextObj;
				// game transform logic
				$('[' + this._stageSelectProperty + '^=' + this._stageNamePrefix + this.currentStage + ']').hide();
				this._getProcess(this.currentStage).stop();
				switch(this.currentStage){
					case 1:
						// for debug
						// this.currentStage = 6;
						// this._totalScore = 88;
						// nextObj = this._getProcess(this.currentStage);
						// break;
					case 2:
					case 6:
						nextObj = this._getProcess(++this.currentStage);
						break;
					case 3:
						nextObj = this._getProcess(++this.currentStage);
						nextObj.changeLevelName("第一關");
						nextObj._hasPersonMove = false;
						nextObj._hasOldmanMove = false;
						document.getElementById('introAudio').pause();
						document.getElementById('playAudio').play();
						break;
					case 4:
						if(this._bombStageTimes == 3){
							this.currentStage = 6;
							this._bombStageTimes = 1;
							document.getElementById('introAudio').play();
							document.getElementById('playAudio').pause();
						}else{
							this.currentStage++;
							this._bombStageTimes++;
							document.getElementById('playAudio').play();
						}
						nextObj = this._getProcess(this.currentStage);
						break;
					case 5:
						this.currentStage = 4;
						nextObj = this._getProcess(this.currentStage);
						if(this._bombStageTimes == 2){
							nextObj.changeLevelName("第二關");
							nextObj._showSeconds = 2;
							nextObj._hasPersonMove = true;
						}else if(this._bombStageTimes == 3){
							nextObj.changeLevelName("第三關");
							nextObj._showSeconds = 1;
							nextObj._hasOldmanMove = true;
							nextObj._forceToJump = true;
						}
						break;
				}
				nextObj.start();
				// transform animation or not
				$('[' + this._stageSelectProperty + '^=' + this._stageNamePrefix + this.currentStage + ']').show();
			},
			loadScores: function(callback){
				var scope = this;
				var Leader = Parse.Object.extend("Leader");
				var query = new Parse.Query(Leader);
				gamer.loading();
				query.descending("score");
				query.limit(10);
				query.find({
				  success: function(results) {
				    // alert("Successfully retrieved " + results.length + " scores.");
				    var outputResults = [];
				    for(var i = 0, len = results.length; i < len; i++){
				    	var item = results[i],
				    		name = item.get('name'),
				    		score = item.get('score'),
				    		date = item.createdAt;
				    	var y = date.getFullYear();
					    var m = (date.getMonth() < 9)? ("0" + (date.getMonth() + 1)) : date.getMonth().toString();
					    var d = (date.getDate() < 10)? ("0" + date.getDate()) : date.getDate().toString();
					    var formatDate = [y,m,d].join('/');

					    outputResults.push({
					    	order: (i + 1),
					    	name: name,
					    	score: score,
					    	date: formatDate
					    });

		  				if(i + 1 == len){
		  					scope._currentMinScore = score;
		  					// scope._checkInput(gamer.shouldBeRecord(score));
		  				}
				    }
				    scope._scoresCount = outputResults.length;
				    gamer.loading(false);
				    if(typeof callback == 'function'){
				    	callback.call(scope, outputResults);
				    }
				  }
				});
			},
			canBeRecord:function(){
				return (this._scoreHasRecord == false && 
					(this._totalScore > this._currentMinScore || this._scoresCount < 10));
			},
			addScoreToRemote:function(name, callback){
				var scope = this;
				if(scope._totalScore){
					var Leader = Parse.Object.extend("Leader");
					var obj = new Leader();
					// var query = new Parse.Query(Leader);
					gamer.loading();
					// query.descending("score");
					// query.limit(10);
					obj.save({
						name: name,
						score: scope._totalScore
					}, {
						success: function(res) {
							// The save was successful.
							gamer.loading(false);
							scope._scoreHasRecord = true;
							if(typeof callback == 'function'){
								callback.call(scope, res);
							}
						},
						error: function(res, error) {
							// The save failed.  Error is an instance of Parse.Error.
							gamer.loading(false);
							alert("發生錯誤！ Error:" + error);
						}
					});
				}else{
					console.error('Gamer: Total score is undefined or zero');
				}
			},
			addScore:function(type){
				var scope = this;
				var animateScore = 0;
				var scoreSelector = "";
				var stageEl = this._getProcessEl(this.currentStage);
				if(type == 'bomb'){
					var co = this._getProcess(this.currentStage);
					var num = co.getProperty("_bombNumbers");
					co.setProperty("_bombNumbers", ++num);
					this._totalScore += 2;
					this.updateScore();
					// var old = parseInt($(".b-counter").text());
					// $(".b-counter").text(++old);
					animateScore = 2;
					scoreSelector = ".b-score-counter";
				}
				if(type == "question"){
					this._totalScore += 5;
					this.updateScore();
					animateScore = 5;
					scoreSelector = ".question-score-counter";
				}
				if(type == "fruit"){
					this._totalScore += 5;
					this.updateScore();	
					animateScore = 5;
					scoreSelector = ".b-score-counter";
				}
				if(type == "fruit" || type == "bomb"){
					setTimeout((function(el){
						return function(){
							el.append('<audio class="score-sound" autoplay><source src="sounds/sound-addscore.mp3" type="audio/mpeg"/></audio>');
							el.children('audio.score-sound:last-child').on('ended', function(){ $(this).remove(); });
						};
					})(stageEl), 200);
				}
				var scoreEl = $(scoreSelector);
				var scorePosition = scoreEl.position();
				var newLeft = scorePosition.left + scoreEl.outerWidth();
				var newTop = scorePosition.top;
				stageEl.append('<div class="score-image score-image-' + animateScore + 
					'" style="left:' + newLeft + 'px;top:' + newTop + 'px;opacity:1;"></div>');
				stageEl.children('.score-image:last-child').animate({
					top:0,opacity:0.2
				},{
					complete:function(){
						$(this).remove();
					}
				});
			},
			updateScore:function(){
				$(".b-score-counter, .question-score-counter").text(this._totalScore);
			},
			startCacheScore:function(){
				this._cacheScore = this._totalScore;
			},
			restoreScore: function(){
				this._totalScore = this._cacheScore;
				this.updateScore();
			},
			shouldBeRecord:function(score){
				return (this._scoreHasRecord == false && this._totalScore > score);
				// gamer._scoreHasRecord == false && gamer._totalScore > this._minScore
			},
			replay:function(){
				this._bombNumbers = 0;
				this._totalScore = 0;
				this._cacheScore = 0;
				this._bombStageTimes = 1;
				this._scoreHasRecord = false;
				this.resetProcess();
				this.forceToStage(1);
			},
			loading:function(toShow){
				if(toShow !== false){
					$(".loading-wrap").show();
				}else{
					$(".loading-wrap").hide();
				}
			}
		};

		

		// window.isFirstTime = (function(){
		// 	function getCookie(name) {
		// 		var value = "; " + document.cookie;
		// 		var parts = value.split("; " + name + "=");
		// 		if (parts.length == 2) return parts.pop().split(";").shift();
		// 		return null;
		// 	}
		// 	function createCookie(name,value,days) {
		// 	    if (days) {
		// 	        var date = new Date();
		// 	        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
		// 	        var expires = "; expires=" + date.toGMTString();
		// 	    }
		// 	    else var expires = "";
		// 	    document.cookie = name + "=" + value + expires + "; path=/";
		// 	}
		// 	var c = getCookie("_hakka");
		// 	var isft = (c && c == "yes");
		// 	createCookie("_hakka", "yes", 365);
		// 	return !isft;
		// })();

		$(document.body).ready(function(){
			// ***** fix a bug about the html rendering between load and ready:
			// browser may be can not doing something about rendering on load or image load?
			gamer.initProcess();

			$(".next-stage").click(function(){
				gamer.toNext();
			});

			$(".prepare").empty();
			// $(".prepare").hide();

			window.waitForFontLoaded = setInterval(function(){
				if(window.isFontLoaded){
					clearInterval(waitForFontLoaded);
					setTimeout(function(){
						gamer.forceToStage(1);
						gamer.loading(false);
					}, 2000);
				}else if(window.fontLoadError){
					alert(window.fontLoadError);
					window.location.reload(true);
				}
			}, 200);
			
		});
  	</script>
  </head>
  <body>
  	<div class="prepare">
  		<!-- <span class="font-zhuin">一二三四五六七八九十</span> -->
  		<span class="font-zhuin-poin1">著被數</span>
  		<span class="font-zhuin-poin2">著數</span>
  		<img width="100%" src="images/01-intro-firework-stop.png"/>
  		<img width="100%" src="images/01-intro-firework.gif"/>
  		<img width="100%" src="images/02-message-oldman-2.gif"/>
  		<img width="100%" src="images/04-bomb9.png"/>
  		<img width="100%" src="images/04-explosion.gif"/>
  		<img width="100%" src="images/04-person-pos.gif"/>
  		<img width="100%" src="images/04-person-neg.gif"/>
  		<img width="100%" src="images/04-oldman-pos.gif"/>
  		<img width="100%" src="images/04-oldman-neg.gif"/>
  		<img width="100%" src="images/04-fruit-1.png"/>
  		<img width="100%" src="images/04-fruit-2.png"/>
  		<img width="100%" src="images/04-fruit-3.png"/>
  		<img width="100%" src="images/04-fruit-4.png"/>
  		<img width="100%" src="images/04-fruit-5.png"/>
  		<img width="100%" src="images/04-fruit-6.png"/>
  		<img width="100%" src="images/score-image-5.png"/>
  		<img width="100%" src="images/score-image-2.png"/>
  		<img width="100%" src="images/word.png"/>
  		<img width="100%" src="images/word-white.png"/>
  	</div>
  	<!-- <div class="font-zhuin">沒什麼事</div> -->
  	<!-- <div id="stage_prepare" class="stage stage-loading" style="display:block;">
  		Loading...
  	</div> -->
  	<div class="loading-wrap">
  		<div class="loading-offset">
  			<img src="images/00-loading.gif" height="100%" />
  		</div>
	</div>
  	<div id="stage_1" class="stage stage-intro">
  		
  		<div class="intro-back">
  			<img src="images/01-intro-back.png" width="100%" />
  		</div>
  		<!-- <div class="intro-back-tmp">
  			<img src="images/01-intro-back-tmp.png" width="100%" />
  		</div> -->
  		<div class="intro-dragon">
  			<img src="images/01-intro-dragon.gif" width="100%" />
  		</div>
  		<div class="intro-girl">
  			<img src="images/01-intro-girl.gif" width="100%" />
  		</div>
  		<div class="intro-word">
  			<img src="images/01-intro-word.png" width="100%" />
  		</div>
  		<div class="next-stage button-intro-enter to-zoom"></div>

  		<!-- for the bugs -->
  		<div class="intro-firework" style="left: 120px; top: 20px; display: none;" f-n="1">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  		<div class="intro-firework" style="left: 348px; top: 0px; display: none;" f-n="2">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  		<div class="intro-firework" style="left: 590px; top: 0px; display: none;" f-n="3">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  		<div class="intro-firework" style="left: 385px; top: 210px; display: none;" f-n="4">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  		<div class="intro-firework" style="left: 320px; top: 369px; display: none;" f-n="5">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  		<div class="intro-firework" style="left: 590px; top: 260px; display: none;" f-n="6">
  			<img width="100%" src="images/01-intro-firework-stop.png">
  		</div>
  	</div>
  	<div id="stage_2" class="stage stage-message">
  		<div class="message-dialog">
  			<img src="images/02-message-dialog.png" width="100%" />
  		</div>
  		<div class="message-oldman">
  			<img src="images/02-message-oldman.gif" width="100%" />
  		</div>
  		<div class="message-text font-zhuin"></div>
  		<div class="message-next">
  			<img src="images/02-message-next.png" width="100%" />
  		</div>
  	</div>
  	<div id="stage_3" class="stage stage-rules">
  		<div class="rules-oldman">
  			<img src="images/02-message-oldman.gif" width="100%" />
  		</div>
  		<div class="next-stage button-rules-enter"></div>
  		<div class="rules-text font-zhuin"></div>
  	</div>
  	<div id="stage_4" class="stage stage-bomb">
  		<div class="font-zhuin info-text level-name"></div>
  		<div class="font-zhuin info-text score-counter-name">積分</div>
  		<div class="font-zhuin info-text b-counter-name">鞭炮<span class="font-zhuin-poin1">數</span></div>
  		<div class="font-zhuin info-text b-timebar-name">時間</div>
  		<div class="font-zhuin b-counter">0</div>
  		<div class="font-zhuin b-score-counter">00000</div>
  		<div class="b-timebar">
  			<div class="HP_bar"> 
		      <div id="bomb_timebar" class="HP_bar_inner" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
		      </div>
		    </div>	
  		</div>
  		
  		<!-- <div class="background-temp">
  			<img src="images/04-backtemp.jpg" width="100%;" />
  		</div> -->

  		<!-- <div class="ballman">
  			<img src="images/04-ballman.png" width="100%" />
  		</div> -->
  		
  		<!-- <div class="people">
  			<img src="images/04-people.png" align="center" width="100%;">
  		</div> -->
  		<div class="dragon-head">
  			<!-- <img src="images/04-head.png" width="100%;"> -->
  			<img src="images/04-dragon-head.gif" width="100%;">
  		</div>
  		<div class="b-transform to-zoom">
  			<div class="b-next-button font-zhuin">
  				<!-- <div class="b-next-button-text">趕快進行下一關</div> -->
  			</div>
  			<div class="b-again-button font-zhuin">
  				<!-- <div class="b-again-button-text">再挑戰一次</div> -->
  			</div>
  		</div>

  		<!-- <div class="move-ballman-wrapper">
		    <div class="move-ballman-innerwrapper">
		        <div id="move"></div>
		    </div>
		</div> -->
		<div id="person_move"></div>
		<div id="oldman_move"></div>
		<!-- <div class="fruit">
			<img src="images/04-fruit-1.png" width="100%" />
		</div> -->
  	</div>
  	<div id="stage_5" class="stage stage-question">
  		<div class="font-zhuin info-text question-level-name"></div>
  		<div class="font-zhuin info-text question-score-counter-name">積分</div>
  		<div class="font-zhuin info-text question-timebar-name">時間</div>
  		<div class="font-zhuin question-score-counter">00000</div>
  		<div class="question-timebar">
  			<div class="HP_bar"> 
		      <div id="question_timebar" class="HP_bar_inner" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
		      </div>
		    </div>	
  		</div>
  		<div class="question-title font-zhuin">小常識</div>
  		<div class="question-text font-zhuin"></div>
  		<div class="question-girl">
  			<img src="images/05-question-girl.gif" width="100%" />
  		</div>
  		<div class="question-button question-yes" a-n="true"></div>
  		<div class="question-button question-no" a-n="false"></div>
  	</div>

  	<div id="stage_6" class="stage stage-results">
  		<div class="results-oldman">
  			<img src="images/02-message-oldman-2.gif" width="100%" />
  		</div>
  		<div class="results-next">
  			<img src="images/02-message-next.png" width="100%" />
  		</div>
  		<div class="font-zhuin results-score"></div>
  		<div class="font-zhuin results-comment"></div>
  	</div>
  	<div id="stage_7" class="stage stage-leader">
  		<div class="leader-confirm"></div>

  		<div class="leader-wrap">
  		</div>
  		<div class="leader-input-wrap">
  			<input id="leader-input" type="text" placeholder="輸入姓名" />
  		</div>
  	</div>
  	<audio autoplay muted preload="auto"> 
		<source src="sounds/sound-addscore.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-addscore.ogg" type="audio/ogg"/>
		<source src="sounds/sound-addscore.wav" type="audio/wav"/> -->
	</audio>
	<audio autoplay muted preload="auto"> 
		<source src="sounds/sound-bomb.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-bomb.ogg" type="audio/ogg"/>
		<source src="sounds/sound-bomb.wav" type="audio/wav"/> -->
	</audio>
	<audio autoplay muted preload="auto"> 
		<source src="sounds/sound-correct.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-correct.ogg" type="audio/ogg"/>
		<source src="sounds/sound-correct.wav" type="audio/wav"/> -->
	</audio>
	<audio autoplay muted preload="auto"> 
		<source src="sounds/sound-wrong.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-wrong.ogg" type="audio/ogg"/>
		<source src="sounds/sound-wrong.wav" type="audio/wav"/> -->
	</audio>
	<audio id="notpassAudio" preload="auto"> 
		<source src="sounds/sound-notpass.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-notpass.ogg" type="audio/ogg"/>
		<source src="sounds/sound-notpass.wav" type="audio/wav"/> -->
	</audio>
	<audio id="passAudio" preload="auto"> 
		<source src="sounds/sound-pass.mp3" type="audio/mpeg"/>
		<!-- <source src="sounds/sound-pass.ogg" type="audio/ogg"/>
		<source src="sounds/sound-pass.wav" type="audio/wav"/> -->
	</audio>
	<audio id="introAudio" preload="auto" loop> 
		<source src="sounds/music-intro.mp3" type="audio/mpeg"/>
	</audio>
	<audio id="playAudio" preload="auto" loop> 
		<source src="sounds/music-playing.mp3" type="audio/mpeg"/>
	</audio>
	<div id="zhuinTest" class="font-zhuin-poin1" style="font-size:24px;"></div>
	<script type="text/javascript">
		gamer.loading();
		// function showTest(){
		// 	var qs = stage5Process._questions;
		// 	var el = $('#zhuinTest');
		// 	for(var i = 0, len = qs.length; i < len; i++){
		// 		el.append((i+1).toString()  + '.' + qs[i].title + '<br/>');
		// 	}
		// }
		// showTest();
		window.isFontLoaded = false;
		fontSpy('DFPYuan-W5-ZhuIn-BFW', {
			testString: '一二三四五六七八九十小朋友你們好啊玩玩看吧',
	        delay: 100,
	        timeOut: 6000,
			success: function() {
				window.isFontLoaded = true;
			},
			failure: function() {
				window.fontLoadError = "Load Fonts Error";
			}
		});
	</script>
  </body>
</html>
